<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gradient Designer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <header class="header">
    <div class="header-content">
      <h1 class="logo">Gradient Designer</h1>
      <a href="./Gradient Designer/Gradient-Designer.html" class="btn-editor">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
        </svg>
        Open Editor
      </a>
    </div>
    <div class="theme-select">
        <select id="themeSelect">
          <option value="auto">Auto</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
          <option value="dep-dark">DepDark</option>
          <option value="midnight">MidNight</option>
        </select>
      </div>
  </header>
  
  <main class="main">
    <section class="hero">
      <h2>Choose a Preset</h2>
      <p>Click any gradient to open it in the editor</p>
    </section>
    
    <div class="filters" id="filters"></div>
    
    <div class="presets-grid" id="presetsGrid">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading presets...</p>
      </div>
    </div>
  </main>
  <script src="./script.js"></script>
  <script>
    // ========== CONFIG ==========
    const PRESETS_URL = './presets.json';
    const EDITOR_URL = './Gradient Designer/Gradient-Designer.html';
    
    // ========== GALLERY ==========
    const Gallery = {
      presets: [],
      currentCategory: 'all',
      
      async init() {
        await this.loadPresets();
        this.renderFilters();
        this.render();
      },
      
      async loadPresets() {
        const grid = document.getElementById('presetsGrid');
        
        try {
          const response = await fetch(PRESETS_URL);
          if (!response.ok) throw new Error('Failed to load');
          
          const data = await response.json();
          this.presets = data.presets || [];
          console.log(`✅ Loaded ${this.presets.length} presets`);
          
        } catch (error) {
          console.error('Error:', error);
          grid.innerHTML = `
            <div class="error">
              <p>❌ Failed to load presets</p>
              <button onclick="Gallery.init()">Retry</button>
            </div>
          `;
        }
      },
      
      getCategories() {
        const cats = new Set(this.presets.map(p => p.category));
        return ['all', ...Array.from(cats)];
      },
      
      filterBy(category) {
        this.currentCategory = category;
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.category === category);
        });
        this.render();
      },
      
      renderFilters() {
        const container = document.getElementById('filters');
        if (!container) return;
        
        const categories = this.getCategories();
        container.innerHTML = categories.map(cat => `
          <button 
            class="filter-btn ${cat === this.currentCategory ? 'active' : ''}" 
            data-category="${cat}"
            onclick="Gallery.filterBy('${cat}')"
          >
            ${cat.charAt(0).toUpperCase() + cat.slice(1)}
          </button>
        `).join('');
      },
      
      render() {
        const grid = document.getElementById('presetsGrid');
        if (!grid) return;
        
        const filtered = this.currentCategory === 'all' 
          ? this.presets 
          : this.presets.filter(p => p.category === this.currentCategory);
        
        if (filtered.length === 0) {
          grid.innerHTML = '<div class="loading">No presets found</div>';
          return;
        }
        
        grid.innerHTML = filtered.map(preset => `
          <div class="preset-card" onclick="Gallery.openPreset('${preset.id}')">
            <div class="preset-card-bg" style="background: ${this.generateCSS(preset)}"></div>
            <div class="preset-card-overlay"></div>
            <div class="preset-card-info">
              <div class="preset-card-name">${preset.name}</div>
              <div class="preset-card-tags">
                ${preset.tags.slice(0, 3).map(t => `<span class="preset-tag">${t}</span>`).join('')}
              </div>
            </div>
          </div>
        `).join('');
      },
      
      generateCSS(preset) {
        const data = preset.data;
        const stops = data.stops?.filter(s => s.visible !== false) || [];
        
        if (stops.length === 0) return data.bgColor || '#000';
        
        const gradients = stops.map(s => {
          if (s.type === 'radial') {
            return `radial-gradient(circle at ${s.x * 100}% ${s.y * 100}%, ${s.color} 0%, transparent 70%)`;
          } 
          else if (s.type === 'linear' && s.stops) {
            const cs = s.stops.map(c => `${c.color} ${c.pos}%`).join(', ');
            return `linear-gradient(${s.angle || 0}deg, ${cs})`;
          } 
          else if (s.type === 'conic' && s.stops) {
            const cs = s.stops.map(c => `${c.color} ${c.pos}%`).join(', ');
            return `conic-gradient(from ${s.startAngle || 0}deg at ${s.x * 100}% ${s.y * 100}%, ${cs})`;
          }
          return '';
        }).filter(Boolean);
        
        return gradients.length > 0 
          ? `${gradients.join(', ')}, ${data.bgColor || '#000'}`
          : data.bgColor || '#000';
      },
      
      openPreset(presetId) {
        const preset = this.presets.find(p => p.id === presetId);
        if (!preset) return;
        
        // ذخیره پریست در sessionStorage
        sessionStorage.setItem('loadPreset', JSON.stringify(preset));
        
        // رفتن به ویرایشگر
        window.location.href = EDITOR_URL;
      }
    };
    
    // Init
    document.addEventListener('DOMContentLoaded', () => Gallery.init());
    window.Gallery = Gallery;
  </script>
</body>
</html>